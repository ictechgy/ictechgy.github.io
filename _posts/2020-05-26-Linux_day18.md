---
title: Linux_day18
---

rpm -e 를 이용하여 vim패키지를 삭제해보았다. 삭제하니까 vi가 작동이 되지 않았다.

centos 홈페이지에서 vim 패키지파일들을 다운로드하였었다.

패키지파일들이 있는 곳으로 커맨드라인을 옮기자
cd /root/다운로드

rpm -qa | grep vim 을 입력해보면 현재 vim 관련 패키지들은 설치되어있지 않은 상태이다.

rpm -ivh vim-X11-7.4.160-4.el7.x86_64.rpm  ← 이름을 쓸 때 복사해서 붙여넣기 해도 되며(복사하고자 하는 이름을 드래그 하고 마우스 오른쪽 클릭) 또는 *사용
오류: Failed dependencies:
        vim-common = 2:7.4.160-4.el7 is needed by vim-X11-2:7.4.160-4.el7.x86_64

설치할 때에도 의존성오류
vim-common이 먼저 필요하다는 오류메시지가 출력되었다.

탑쌓기개념으로 보자면 vim-X11을 쌓기 전에 그 밑에 vim-common이 먼저 쌓여져 있어야 그 위에 쌓을 수 있다는 뜻


 rpm -ivh vim-common-7.4.160-4.el7.x86_64.rpm
오류: Failed dependencies:
        vim-filesystem is needed by vim-common-2:7.4.160-4.el7.x86_64

또 뜬다. vim-common을 설치하기 위해서는 vim-filesystem이 필요하다!


rpm -ivh vim-filesystem-7.4.160-4.el7.x86_64.rpm
rpm -ivh vim-common-7.4.160-4.el7.x86_64.rpm
rpm -ivh vim-X11-7.4.160-4.el7.x86_64.rpm
→ 잘 설치가 된다.


vim-X11 → vim-common → vim-filesystem
	  의		     의

의존성에 관여를 안받고 강제설치를 하거나 의존성에 해당하는 것까지 다 자동으로 설치하는 옵션은 없을까?
→ 나중에 보면 알겠지만 강제로 설치하는 옵션은 --force 이며 의존성무시는 --nodeps, 의존성 관련까지 다 자동으로 삭제 또는 설치해주는 것은 yum명령어를 써야한다.

rpm -ivh vim-enhan*
rpm -ivh vim-mini*
→ 나머지 다 잘 설치되었다. 저 패키지들도 common이나 다른 패키지에 의존성을 가지고 있을 수 있는데 설치를 해 놓았기때문에 문제가 안뜨는 것일 수 잇다.


rpm -qa | grep vim
→ 다섯개 다 잘 설치가 되었다. 근데 처음에는 4개밖에 없었는데 X11은 무엇인가?

vi도 이제 잘 작동한다.
vim이 무슨 약어인가 찾아보니  vi improved 였다.

rm -rf * 로 패키지파일 지우자. 설치를 전부 잘 했으니까..



rpm 작업시 요령(방법)
1) 패키지 작업시 주요 패키지명에 포함되는 하위패키지들은 반드시 동일한 버전으로 작업을 해야함. 
(단! 설치하는 패키지에 관련된 별도의 패키지는 버전이 다를 수 있음)

2) 의존성 오류(Failed Dependencies)를 절대로 무시하면 안됨
(반드시 해결해야한다)

3) 의존성 오류를 제기한 새로운 패키지를 먼저 작업해야함(탑 먼저쌓기)

4) ‘lib’으로 시작해서 중간에 ‘so’라는 문구가 나오면 보류
그리고 위 문구 외에 다른 패키지가 있으면 먼저 그 패키지를 작업
자동으로 ‘lib’으로 시작해서 중간에 ‘so’가 있는 문구가 사라지게 됨. 만약에 계속 ‘lib’으로 시작해서 중간에 ‘so’가 있는 문구가 출력되면 그것은 패키지일 가능성이 있으므로 패키지를 찾아서 해결

5) 디렉토리로 시작하는 것들(/usr/bin 등) 은 패키지가 아니므로 무시하면 됨

6) 모든 작업은 반드시 대표패키지부터 작업을 해야함
(대표 패키지는 거의 맨 처음 의존성 오류에서 출력되는 것들)

7) 작업을 하면서 나머지 패키지는 보이는 순서대로 진행해야함(순서대로 하지 않으면 헷갈리게 됨)


데이터베이스와 관련된 패키지를 삭제하고 설치해보자

rpm 실습
실습할 패키지명은 mariadb

설치되어있는 mariadb 패키지를 조회하고 삭제! 
그리고 삭제 후 확인 한 다음

mariadb로 시작하는 패키지를 모두 설치!
그리고 설치 후 확인



처음에 mariadb를 지우려 할 때 뜨는 의존성 오류에 의하면 libmysqlclient를 postfix가 요구하고 있다는데, libmysqlclient가 mariadb안에 있는 어떤 파일인가봄. 따라서 postfix를 먼저 제거해야 libmysqlclient를 지울 수 있는거고 그 뜻은 그렇게 해야 mariadb를 지울 수 있다는 것

잘 제거를 하면 rpm -qa | grep mariadb 입력시 아무것도 나오지 않는다.

이제 centos로 가서 mariadb와 관련된 패키지파일들을 다운로드 해주자. 총 8개를 다운로드받으면 된다. 다운로드받을 때 주의사항은, 패키지파일의 시스템 아키텍쳐를 잘 보고 맞는 것을 다운로드 받아야한다. i686아키텍쳐가 아닌 x86_64로 다운받자! (i686을 받아도 해당 rpm 패키지파일이 설치가 될 지는 잘 모르겠다.)

이제 하나씩 설치를 진행해 나아가면 된다.

옵션에 보면 더이상 의존성파일을 요구 안하게 --noorder 옵션도 있으며 진행상황을 퍼센트로 표시하는 --percent 옵션도 있다.(-h 로 hash옵션 쓰면 퍼센트도 나오긴 함)

설치를 진행하다보면 의존성이 요구되는 패키지나 파일들이 너무 많이 나오고 충돌도 많이 일어난다. 충돌무시 --replacefiles 옵션도 있다.

충돌 어찌 해결해야하는가? 의존성은 끝도없이 퍼져나가고.
네이버에 ‘리눅스 패키지 충돌’ 로 검색하니 mariadb에 관련해서 글이 하나 나오기는 한다.(내용 보니까 충돌에 대해 무시하는 --nodeps 옵션 사용하는 글이 나옴)
 
mariadb 패키지를 받을 때에는 시스템 아키텍쳐 잘 보고 다운받기


충돌 → 설치되어있는 녀석을 확인
내가 가지고 있는 것을 확인

버전이 달라서 충돌이 난다.. 즉 a라는 패키지를 설치하기 위해서 b라는 패키지가 필요한데 b라는 패키지는 이미 설치되어있다. 근데 오류가 나는 이유는? a라는 패키지버전이 5이고 b또한 5라고 할때, a라는 패키지를 깔려면 b의 5버전이 필요하다. 그런데 컴퓨터에는 b3버전이 깔려있는 것이다! 따라서 a5깔려고 하면 b5깔라고 하는건데 b5깔려니까 이미 설치되어있는 b3과 충돌이 일어나는 것이다..

기존것을 지우고 새 것을 깔 수도 있고.,, 그냥 기존것을 쓸 것이냐..
그런데 우리가 작업을 하던 것이 최신버전이다보니까.. 기존것을 쓴다면 기존버전으로 전부 찾아서 설치해야한다…  위의 예를 들면 a5가 아닌 a3를 찾아서 써야하는 방식..
따라서 기존 것을 지우는 것이 좋다.


근데 기존것 지우려는데 또 의존성이 걸려있는게 너무 많다.. 의존성이 있는 것들을 다 지우기에는 위험하다. 어떤 역할을 하고 있을지를 모른다.
rpm -e krb5-libs


기존것은 8버전이고 우리가 설치하려는 것이 18버전이다.

→ 업그레이드하자. (다운그레이드도 있긴 하다)
rpm -qa | grep krb5-libs   → 충돌도 일어나고 많이 오류가 나는 쪽

rpm -Uvh krb5-libs*
업데이트완료



그런데 업그레이드하려고 하는데도 또 의존성오류가 뜨는 경우가 있다. 위의 krb5-libs는 삭제하려니까 의존성오류가 떴었고 그래서 업데이트를 선택하였다. 그런데 이번에는 삭제에도 의존성이 많이 뜨는데, 업데이트에도 의존성이 뜬다. 
rpm -Uvh libcom_err-1.42.9-11.el7.x86_64.rpm
→ libcom_err의 기존 패키지 파일들에 의존성파일들이 묶여있어서 함부로 업데이트를 못하는 상황도 발생한다.

이에 대해 의존성이 있는 패키지를 설치하려고 하면 또 의존성이 뜨고..
엄청나게 꼬이고 꼬여서 복잡해져버렸다.


--force 강제도 안됨.. 의존성오류에 있어서.,

rpm -Uvh --oldpackage libcom_err*  → oldpackage로 update하겠다. 즉 다운그레이드
다운그레이드도 안되고.. 다운받아놓은 패키지파일이 더 낮은버전이어야함. 설치되어있는 것보다. 근데 우리는 지금 다운해놓은게 설치되어있는 것보다 상위버전이다.  따라서 작동하긴 하는데 설치가 안된다. 역시나..  그리고 --force를 덧붙여도 안되고..


일단 건너뛰고 다른 것부터 설치해보자.
rpm -ivh libselinux-devel-2.5-12.el7.x86_64.rpm

의존성오류중에
pkgconfig(libpcre) is needed by libselinux-devel-2.5-12.el7.x86_64
        pkgconfig(libsepol) is needed by libselinux-devel-2.5-12.el7.x86_64
두 항목이 존재한다.

pkgconfig라는 패키지파일을 다운받아서 설치하려고 하면 해당 패키지가 이미 설치되어있다고 한다. 보니까 설치되어있는 버전과 다운로드한 버전이 동일하다.
→ 이미 잘 설치되어있는데 의존성 패키지로서 뜨는 오류? 
저 파일들은 pkgconfig에 해당하는 것이 아니라 libpcre와 libsepol 안에 있는 pkgconfig라는 것이다. 따라서 우리는 libpcre와 libsepol을 설치해줘야 한다.

패키지 찾는데 안나오는 경우. libpcre 검색 안나오는데 보통 이러한 경우 앞의 lib를 빼고 pcre로 검색하면 나온다.
libsepol은 이미 다운받아있었고(이미 이전에 의존성에서 떴었어서) -ivh는 안되서 -Uvh하니까 업뎃 완료.
다시 rpm -ivh libselinux-devel-2.5-12.el7.x86_64.rpm 쳤는데.. 왜 의존성오류가 안사라지냐 libsepol도 안사라지고.. libpcre도 이미 설치되어있다고 떠놓고선!!!!

일반적 패키지파일은 devel들과 묶여다닌다. 따라서 어떤 패키지를 설치 할 때 devel 패키지 설치도 요구되는 경우가 많다.


비장의 초필살기라고 하셨다. 이렇게 꼬인경우..
rpm -ivh --nodeps mariadb-devel-5.5.56-2.el7.x86_64pm
의존성 무시
의존성을 무시하는 것은 좋을수도 나쁠수도 있다.

정말 쓸데없이 의존성 나오는 경우 써도 되는데 마구 쓰다가는 프로그램에 문제가 생길 수 있다.


rpm -ivh mariadb-test-5.5.56-2.el7.x86_64.rpm 로 패키지 설치하려 하는 경우 perl(Env)와 perl(Test::More)의존성이 나온다. perl Env는 찾을 수 있다. 그런데 perl(Test::More) 는 안나오는데 뭘 뜻하는가?
→ perl Test Simple 을 뜻한다고 한다. 어떻게 저 이름이 나오는지는 나중에 배운다고 하심..


 rpm -qa | grep mariadb | nl
다 설치하면 8개인데 실질적으로 다운받은 패키지 파일들은 너무나 많다…



rpm 관련 option

--nodeps : 의존성을 검사하지 않음(무시)
--force : 강제
-U : Upgrade. 기존에 패키지가 설치되어있는 경우에 버전을 업그레이드하거나 다운그레이드 할 때 사용
--oldpackage : 이미 설치되어있는 버전보다 낮은 버전의 패키지파일을 이용하여 다운그레이드 하고자 할 때 사용(-U를 쓴 뒤에 사용)

의존성메시지를 띄우지 않는데에 --noorder 옵션도 있는 것 같고 -U대신에 --replacefiles옵션도 있는 것 같다.

yum(Yellowdog Updater, Modified)
누렁이 업데이터 수정. 개가 말을 잘듣는다?
RPM 설치를 개선하기 위해서 개발한 패키지 관리자 (Duke University)
인터넷을 통해서 필요한 파일을 저장소에 자동으로 설치하는 방식
RPM에서 힘들었던 의존성을 쉽게 해결함(자동 해결)
마치 Windows에서 Windows Update와 비슷함


yum과 관련된 파일 및 디렉토리

/etc/yum.conf
yum의 설정 파일

/etc/yum/pluginconf.d
yum 플러그인의 설정파일이 저장되어있는 디렉토리(언어팩같은 파일이 있음)

/etc/yum/protected.d
패키지명을 기록해두면 해당 패키지를 설치하지 않거나 삭제하지 않게 된다.(해당 설정파일을 저장하고 있는 디렉토리)
안에 ls -al /etc/yum/protected.d 로 보면 systemd.conf 파일밖에 존재하지 않는데, vi로 켜도 systemd 라는 한 단어밖에 존재하지 않는다. 패키지보호를 위해 뭔가를 더 추가하려 한다면 어떤 방식으로 추가해야하는걸까?

/etc/yum/vars
*.repo 파일 내에 사용할 수 있는 환경변수를 정의하는 파일을 저장하고 있는 디렉토리

/etc/yum.repos.d 
사용할 인터넷상의 저장소에 대한 정보 및 설정파일을 저장하고 있는 디렉토리

repo - repository 저장소

/etc/yum.repos.d/CentOS-Base.repo 파일의 내용 중 항목

vi /etc/yum.repos.d/CentOS-Base.repo

[base]
yum 서버의 기본 패키지 저장소 정보

[update]
release 업데이트 패키지가 모여있는 저장소 정보
[extras]
유용한 추가 패키지가 모여있는 저장소 정보
[centosplus]
확장기능을 제공하는 추가 패키지가 모여있는 저장소 정보


/var/log/yum.log
yum 사용시 관련 기록을 저장하는 파일

/usr/bin/yum
yum 명령어 실행파일
환경변수 path로 지정되어있기 때문에 커맨드라인이 어디에 있든 사용가능함(아마도 /etc/profile 쪽에 지정되어있지 않을까 하는 추측)


사용형식

yum help 또는 man yum
yum 도움말

yum list 패키지명
Redhat 계열 리눅스(현재 OS)에 설치되어 있는 패키지 리스트를 출력
(참고로 패키지명을 생략하면 설치되어있는 모든 패키지 리스트를 출력)
→ yum list mariadb 를 치면 설치되어있는 mariadb가 나오게 됨. 존재하지 않는 패키지라면 
Error: No matching Packages to list 라는 메시지가 나온다.
‘rpm -qa 또는 rpm -qa | grep 패키지명’ 을 한 것과 동일하다.

yum info 패키지명(또는 그룹패키지명)
패키지 또는 그룹패키지를 자세하게 확인
→ ‘rpm -ql 패키지명’을 한 것과 동일하다. 패키지에 대한 내부파일을 출력한다.
‘rpm -qf 파일명’ 을 하면 해당 파일이 어느 패키지에 속해있는지를 알 수 있다.
‘rpm -qi 패키지명’ 을 하면 해당 패키지에 대한 정보가 나오게 된다.

yum install 패키지명
Redhat계열 리눅스에 설치되어있지 않은 패키지를 설치
패키지명을 생략한다면 설치되어있지 않은 패키지를 모두 설치하나?
rpm -i 와 동일하네.

yum erase 패키지명
Redhat 계열 리눅스에 설치되어있는 패키지를 삭제
rpm -e 와 동일

yum reinstall 패키지명
Redhat 계열 리눅스에 설치되어 있는 패키지를 재설치
rpm같은 경우 동일 버전의 패키지가 이미 설치되어있다면 ‘이미 설치되어있습니다’라는 메시지를 띄우고 아무것도 되지 않는다.

yum groupinstall 그룹패키지명
Redhat 계열 리눅스에 설치되어 있지 않은 그룹패키지를 설치
그냥 ‘yum install 그룹패키지명’ 해도 되지 않을까?


yum groupremove 그룹패키지명
Redhat 계열 리눅스에 설치되어 있는 그룹패키지를 삭제

yum all clean
cache(기록, 캐시) 되어있는 것을 모두 지움
임시파일같은걸 지우는건가? yum으로 설치 할때 사이트에 있는 패키지파일을 다운받아서 설치하는 방식일텐데.. 그걸 임시파일로서 저장해두고 패키지설치를 진행하는 것 아닐까? 이럴 때 캐시파일을 지우는 명령어인 것 같다. 물론 지우지 않아도 나중에 자동으로 지워줄수도 있고..

yum update 패키지명
Redhat 계열 리눅스에 설치되어있는 패키지를 update함
(참고로 패키지명을 생략하게 되면 모든 패키지를 update함)

yum upgrade 패키지명
Redhat 계열 리눅스에 설치되어있는 모든 패키지를 upgrade 함
(참고로 패키지명을 생략하게 되면 모든 패키지를 upgrade함)


upgrade는 update하는 건 동일하나 구식(오래된) 패키지를 대체하는 새로운 패키지가 지정되어 있을 경우 구식(오래된) 패키지를 삭제하고 새로운 패키지를 사용함
update는? 구식파일은 그대로 남겨둔다는건가? 

windows update와
windows upgrade
보통 OS쪽을 올릴 때 업그레이드라는 용어를 쓰고 하나의 프로그램에서 버전을 올릴 때 업데이트라는 말을 쓴다..
구글에 찾아보니까 업그레이드는 어떤 큰 질적향상을 의미할 때 쓰는 용어라고 한다. 하드웨어든 소프트웨어든 어디에나 쓸 수 있는 단어라고 한다.
다만 업데이트는 보통 소프트웨어에 쓰는 단어이며 버전이 올라가는 업데이트 라는 말등에 쓰이거나.. 아니면 질적향상은 이루어지지 않은 채 단지 갱신의 의미로 쓰이기도 한다. ex) 뉴스 최신글 업데이트


GUI로 들어가서 터미널창을 켜보자.

yum erase mariadb-libs
→ postfix 의존성파일이 있었다.
인터넷이다보니까 진행속도가 조금 느리다.

만약 터미널창이 계속 분석만 하고 있다면.. 다른 터미널을 켜서
kill -9 2446 
kill 시그널 PID값
→ 입력하면 yum 진행이 멈춤. 

분석이 완료되면 [y/n]이 뜨게 되고 y를 입력 후 엔터를 치면..
의존성파일을 알아서 다 지워주고 mariadb까지 지운다.


yum install mariadb를 치면..
y/d/n   (d는 다운로드) 가 뜨는데 y를 입력 후 엔터를 치면 의존성패키지파일부터 설치하고 다 잘 설치한다.
d를 입력하는건 뭐를 의미하는걸까? 그냥 다운로드만 해두는거? 나중에 rpm으로 깔 수도 있으려나. 
그리고 다운로드는 어디에 되는거지. 홈디렉토리의 다운로드디렉토리 하위?

그리고 install해서 파일받아올 때 자동으로 mirror 링크를 kakao서버로 잡던데 그러한 것들도 다 자동인건가 아니면 kakao로 미리 설정되어있는건가… 그냥 사용자의 위치를 알아서 파악하고 미러를 잡든지 아니면 각종 미러링크 다 핑 테스트 해서 가장 낮은곳 찾아서 하는 것 같기도 하다. 

putty에서 rpm -qa | grep mariadb 하면 설치가 된 것을 확인 할 수 있다. 3개밖에 안뜨긴 하지만…
아니면 yum list mariadb 를 해도 나오기는 한다.. 근데 조금 다르게 나오네?


yum install mariadb-devel 을 하면 다 잘 해결해준다. 업데이트가 필요한 것들은 업데이트저장소에서 받아서 설치해주고 설치되어있지 않은 것들은 base저장소에서 받아서 설치를 다 해주는 것 같다. 
의존성문제까지 전부 싹 다 깔끔하게.. 해결

다시 rpm -qa | grep mariadb 를 쳐보면 mariadb-devel까지 총 4개가 다 설치가 되었다.. 뭐 필요한게 있으면 알아서 다 찾아서 패키지 설치를 하면 될 것 같다. 의존성부분 해결해준 것이 가장 깔끔하고 편리함

yum list mariadb 치면 
mariadb.x86_64                       1:5.5.56-2.el7                        @base 이렇게 뜨는데..

yum list mariadb-devel 치면
mariadb-devel.x86_64                    1:5.5.56-2.el7                     @base
이렇게 뜬다.

→ 아 세개가 아니라 딱 검색한 패키지 완전일치하는 것만 뜨는것 같다.. 버전과 base인지 update에서 받은건지 뭔지 그런것만 딱 뜨는 것 같다. 세개뜨는건줄..
다만 rpm -qa | grep mariadb 처럼 여러개가 나오지는 않네

yum이 인터넷을 통해 하는 것인데 혹여나 인터넷이 잘 되지 않으면 rpm을 쓰도록 한다.
yum이 최신패키지를 찾지 못하는 경우 내가 직접 패키지파일을 받아서 쓸 때 등.. 그럴 때는 rpm 이용 가능. 

ISO 파일에 패키지파일이 들어있으므로 그 안에 있는 패키지파일을 이용해서 rpm을 쓰면 됨

yum update 를 하는 것이 그 GUI에서 프로그램업데이트 메시지뜨는데, 그걸 설치하는 것과 같은건가



내일은 장치쪽배울 것.
ISO 파일 열어서 패키지파일 뽑아내고 그걸 rpm으로 설치해보자?
