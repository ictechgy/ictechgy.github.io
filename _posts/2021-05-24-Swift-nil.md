---
title: Swift(스위프트) nil에 대한 기록 with RxSwift
categories:
- Swift
- RxSwift
toc: true
toc_sticky: true
toc_label: 목차
---

Swift를 다시 공부하던 도중 기록하면 좋을만한 부분이 있어서 작성한다.


Any?, AnyObject? 같은 옵셔널이 아닌 Any, AnyObject 등에는 nil을 직접적으로 넣을 수 없다. 하지만 아래와 같은 경우에는 가능하다.
```swift
let a: Int? = nil
let b: Any = a as Any   //syntax error가 뜨지 않는다. 'Any?'로 쓰십시오!라고 뜰 줄 알았는데..
 ```
 b는 실질적으로 nil이지만 nil이 아닌 것처럼 보인다. 이런 부분에 있어 유의하도록 하자.

&nbsp;

위와 같은 경우가 있을 수 있다는 것은 [RxSwift Github - 'CLLocationManager+Rx' Example](https://github.com/ReactiveX/RxSwift/blob/main/RxExample/Extensions/CLLocationManager%2BRx.swift)을 통해 알았다.   

```swift
private func castOptionalOrThrow<T>(_ resultType: T.Type, _ object: Any) throws -> T? {
    if NSNull().isEqual(object) {
        return nil
    }
		 //NSNull: nil을 허용하지 않는 콜렉션에서 null value를 대표하는 싱글톤 오브젝트
     //nil이지만 nil이 아닌것처럼 쓸 수 있다는 건가?

    guard let returnValue = object as? T else {
        throw RxCocoaError.castingError(object: object, targetType: resultType)
    }

    return returnValue
}
```
링크 맨 밑에 위와 같은 함수가 있는데 'nil일 수 있는 인자를 Any?가 아닌 Any타입의 object로 받는 것'과 내부에서 'nil 체크를 NSNull().isEqual()로 하는 것'을 보고.. 처음에 굉장히 혼란스러웠다. 왜 object 파라미터가 Any?타입이 아닌 Any일까 하면서.. 물론 외부에서 넘어오는 것 자체가 \[Any]에서 하나를 고른 Any이기는 하지만.

delegate.methodInvoked()에 의해 메소드 파라미터들은 Any로 캐스팅되고 [Any] 배열로 반환된다. 따라서 특정 파라미터는 Any타입이라고 보여도 사실은 nil일 수 있다. (이를테면 CLLocationManagerDelegate - didFinishDeferredUpdatesWithError의 두번째 파라미터는 Error? 옵셔널인데, Any로 캐스팅되어도 사실 nil일 수 있다는 것)   
그렇다면 methodInvoked()에 의해 반환되는 시퀀스가 Observable\<Any>가 아닌 Observable\<Any?>이어야 하는 것 아닌가?
